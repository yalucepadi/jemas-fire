<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tienda - Con Firebase Database</title>
    <link href="https://fonts.googleapis.com/css2?family=Archivo+Black&family=DM+Sans:wght@400;500;700&display=swap" rel="stylesheet">

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #FF6B35;
            --secondary: #004E89;
            --accent: #F7B801;
            --dark: #1A1A2E;
            --light: #F5F5F5;
            --success: #2ECC71;
        }

        body {
            font-family: 'DM Sans', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: var(--dark);
        }

        /* Header */
        header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 1.5rem 2rem;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-family: 'Archivo Black', sans-serif;
            font-size: 2rem;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .admin-btn {
            background: var(--secondary);
            color: white;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 50px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            font-size: 0.95rem;
        }

        .admin-btn:hover {
            background: var(--primary);
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(255, 107, 53, 0.4);
        }

        /* Container Principal */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        /* Carrusel de Primicias */
        .carousel-section {
            background: white;
            border-radius: 20px;
            padding: 2.5rem;
            margin-bottom: 3rem;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
            animation: slideUp 0.6s ease;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .section-title {
            font-family: 'Archivo Black', sans-serif;
            font-size: 2.5rem;
            margin-bottom: 1.5rem;
            color: var(--secondary);
            text-align: center;
        }

        .carousel {
            position: relative;
            overflow: hidden;
            border-radius: 15px;
            height: 400px;
        }

        .carousel-track {
            display: flex;
            transition: transform 0.5s ease-in-out;
            height: 100%;
        }

        .carousel-item {
            min-width: 100%;
            height: 100%;
            position: relative;
            overflow: hidden;
        }

        .carousel-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .carousel-caption {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(to top, rgba(0, 0, 0, 0.8), transparent);
            color: white;
            padding: 2rem;
        }

        .carousel-caption h3 {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .carousel-nav {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(255, 255, 255, 0.9);
            border: none;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.5rem;
            transition: all 0.3s ease;
            z-index: 10;
        }

        .carousel-nav:hover {
            background: var(--primary);
            color: white;
            transform: translateY(-50%) scale(1.1);
        }

        .carousel-nav.prev {
            left: 20px;
        }

        .carousel-nav.next {
            right: 20px;
        }

        .carousel-dots {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 10px;
            z-index: 10;
        }

        .dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.5);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .dot.active {
            background: white;
            width: 30px;
            border-radius: 6px;
        }

        /* Categor√≠as */
        .categories-section {
            background: white;
            border-radius: 20px;
            padding: 2.5rem;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
            animation: slideUp 0.6s ease 0.2s both;
        }

        .category-filters {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
            justify-content: center;
        }

        .category-btn {
            background: var(--light);
            border: 2px solid transparent;
            padding: 0.8rem 1.8rem;
            border-radius: 50px;
            cursor: pointer;
            font-weight: 600;
            font-size: 1rem;
            transition: all 0.3s ease;
            color: var(--dark);
        }

        .category-btn:hover {
            border-color: var(--primary);
            transform: translateY(-2px);
        }

        .category-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 2rem;
        }

        .product-card {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .product-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.2);
        }

        .product-card img {
            width: 100%;
            height: 250px;
            object-fit: cover;
        }

        .product-info {
            padding: 1.5rem;
        }

        .product-info h4 {
            font-size: 1.2rem;
            margin-bottom: 0.5rem;
            color: var(--secondary);
        }

        .product-info p {
            color: #666;
            margin-bottom: 1rem;
        }

        .product-price {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
        }

        /* Modal de Login Admin */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 3rem;
            max-width: 500px;
            width: 90%;
            animation: modalPop 0.4s ease;
        }

        @keyframes modalPop {
            from {
                opacity: 0;
                transform: scale(0.8);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .modal-content h2 {
            font-family: 'Archivo Black', sans-serif;
            margin-bottom: 2rem;
            color: var(--secondary);
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--dark);
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 1rem;
            border: 2px solid var(--light);
            border-radius: 10px;
            font-size: 1rem;
            transition: border 0.3s ease;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: var(--primary);
        }

        .modal-buttons {
            display: flex;
            gap: 1rem;
            margin-top: 2rem;
        }

        .btn {
            flex: 1;
            padding: 1rem;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
        }

        .btn-primary {
            background: var(--secondary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary);
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: var(--light);
            color: var(--dark);
        }

        .btn-secondary:hover {
            background: #e0e0e0;
        }

        /* Panel de Administraci√≥n */
        .admin-panel {
            display: none;
            background: white;
            border-radius: 20px;
            padding: 2.5rem;
            margin-bottom: 3rem;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
        }

        .admin-panel.active {
            display: block;
            animation: slideUp 0.6s ease;
        }

        .admin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .logout-btn {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 50px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .logout-btn:hover {
            background: #c0392b;
            transform: translateY(-2px);
        }

        .admin-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 2rem;
        }

        .admin-item {
            position: relative;
            background: var(--light);
            border-radius: 15px;
            padding: 1.5rem;
            transition: all 0.3s ease;
        }

        .admin-item:hover {
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .admin-item img {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 10px;
            margin-bottom: 1rem;
        }

        .admin-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .btn-edit, .btn-delete {
            flex: 1;
            padding: 0.6rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-edit {
            background: var(--accent);
            color: var(--dark);
        }

        .btn-edit:hover {
            background: #e6a701;
            transform: translateY(-2px);
        }

        .btn-delete {
            background: #e74c3c;
            color: white;
        }

        .btn-delete:hover {
            background: #c0392b;
            transform: translateY(-2px);
        }

        .add-product-btn {
            background: var(--success);
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 50px;
            cursor: pointer;
            font-weight: 700;
            font-size: 1.1rem;
            margin-bottom: 2rem;
            display: inline-block;
            transition: all 0.3s ease;
        }

        .add-product-btn:hover {
            background: #27ae60;
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(46, 204, 113, 0.4);
        }

        .loading {
            text-align: center;
            padding: 3rem;
            color: var(--secondary);
            font-size: 1.2rem;
        }

        .setup-notice {
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 15px;
            padding: 2rem;
            margin: 2rem 0;
            animation: slideUp 0.6s ease;
        }

        .setup-notice h3 {
            color: #856404;
            margin-bottom: 1rem;
        }

        .setup-notice code {
            background: #f8f9fa;
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
            color: #e83e8c;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .logo {
                font-size: 1.5rem;
            }

            .section-title {
                font-size: 2rem;
            }

            .carousel {
                height: 300px;
            }

            .products-grid {
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
                gap: 1rem;
            }

            .category-filters {
                gap: 0.5rem;
            }

            .category-btn {
                padding: 0.6rem 1.2rem;
                font-size: 0.9rem;
            }
        }
        .contact-float {
    position: fixed;
    bottom: 20px;
    right: 20px;
    background: var(--primary);
    color: white;
    padding: 0.9rem 1.4rem;
    border-radius: 50px;
    font-weight: 700;
    text-decoration: none;
    box-shadow: 0 10px 25px rgba(0,0,0,0.25);
    z-index: 3000;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.contact-float:hover {
    background: var(--secondary);
    transform: translateY(-3px);
}

/* Responsive */
@media (max-width: 480px) {
    .contact-float {
        padding: 0.7rem 1.1rem;
        font-size: 0.9rem;
        bottom: 15px;
        right: 15px;
    }
}
    </style>
    <a href="https://wa.me/51921330024?text=He%20visto%20un%20producto%20de%20tu%20tienda%20JEMAS%20y%20quiero%20preguntar%20por%20√©l" class="contact-float" target="_blank">
    üí¨ Cont√°ctame
</a>

</head>
<body>
    <!-- Header -->
    <header>
        <div class="logo">üõçÔ∏è JEMAS</div>
        <button class="admin-btn" onclick="openLoginModal()">Admin Panel</button>
    </header>

    <div class="container">
        <!-- Aviso de configuraci√≥n (se muestra solo si Firebase no est√° configurado) -->
        <div class="setup-notice" id="setupNotice" style="display: none;">
            <h3>‚ö†Ô∏è Configuraci√≥n Requerida</h3>
            <p>Para usar la base de datos, necesitas configurar Firebase:</p>
            <ol style="margin-left: 1.5rem; margin-top: 1rem;">
                <li>Ve a <a href="https://console.firebase.google.com" target="_blank" style="color: var(--primary);">Firebase Console</a></li>
                <li>Crea un proyecto nuevo</li>
                <li>Activa <strong>Firestore Database</strong></li>
                <li>Copia las credenciales y p√©galas en el c√≥digo (l√≠nea 850)</li>
            </ol>
            <p style="margin-top: 1rem; color: #666;">Mientras tanto, la tienda funciona con datos de ejemplo en memoria.</p>
        </div>

        <!-- Panel de Administraci√≥n -->
        <div class="admin-panel" id="adminPanel">
            <div class="admin-header">
                <h2 class="section-title" style="margin: 0;">Panel de Administraci√≥n</h2>
                <button class="logout-btn" onclick="logout()">Cerrar Sesi√≥n</button>
            </div>
            <button class="add-product-btn" onclick="openAddProductModal()">+ Agregar Producto</button>
            <div class="admin-grid" id="adminGrid">
                <!-- Los productos se cargar√°n aqu√≠ din√°micamente -->
            </div>
        </div>

        <!-- Carrusel de Primicias -->
        <section class="carousel-section">
            <h2 class="section-title">‚ú® Primicias de la Semana</h2>
            <div class="carousel">
                <div class="carousel-track" id="carouselTrack">
                    <div class="loading">Cargando primicias...</div>
                </div>
                <button class="carousel-nav prev" onclick="moveCarousel(-1)">‚Äπ</button>
                <button class="carousel-nav next" onclick="moveCarousel(1)">‚Ä∫</button>
                <div class="carousel-dots" id="carouselDots"></div>
            </div>
        </section>

        <!-- Categor√≠as y Productos -->
        <section class="categories-section">
            <h2 class="section-title">Nuestros Productos</h2>
            <div class="category-filters" id="categoryFilters">
                <button class="category-btn active" onclick="filterCategory('todos')">Todos</button>
                <button class="category-btn" onclick="filterCategory('peluches')">üß∏ Peluches</button>
                <button class="category-btn" onclick="filterCategory('ropa')">üëï Ropa</button>
                <button class="category-btn" onclick="filterCategory('accesorios')">üëú Accesorios</button>
                <button class="category-btn" onclick="filterCategory('juguetes')">üé≤ Juguetes</button>
            </div>
            <div class="products-grid" id="productsGrid">
                <div class="loading">Cargando productos...</div>
            </div>
        </section>
    </div>

    <!-- Modal de Login -->
    <div class="modal" id="loginModal">
        <div class="modal-content">
            <h2>üîê Acceso Administrador</h2>
            <div class="form-group">
                <label for="username">Usuario</label>
                <input type="text" id="username" placeholder="Ingresa tu usuario" value="admin">
            </div>
            <div class="form-group">
                <label for="password">Contrase√±a</label>
                <input type="password" id="password" placeholder="Ingresa tu contrase√±a" value="admin123">
            </div>
            <div class="modal-buttons">
                <button class="btn btn-secondary" onclick="closeLoginModal()">Cancelar</button>
                <button class="btn btn-primary" onclick="login()">Ingresar</button>
            </div>
        </div>
    </div>

    <!-- Modal para Agregar/Editar Producto -->
    <div class="modal" id="productModal">
        <div class="modal-content">
            <h2 id="productModalTitle">Agregar Producto</h2>
            <div class="form-group">
                <label for="productName">Nombre del Producto</label>
                <input type="text" id="productName" placeholder="Ej: Peluche Oso">
            </div>
            <div class="form-group">
                <label for="productCategory">Categor√≠a</label>
                <select id="productCategory">
                    <option value="peluches">Peluches</option>
                    <option value="ropa">Ropa</option>
                    <option value="accesorios">Accesorios</option>
                </select>
            </div>
            <div class="form-group">
                <label for="productPrice">Precio</label>
                <input type="number" id="productPrice" placeholder="0.00" step="0.01">
            </div>
            <div class="form-group">
                <label for="productDescription">Descripci√≥n</label>
                <input type="text" id="productDescription" placeholder="Descripci√≥n breve">
            </div>
            <div class="form-group">
                <label for="productImage">URL de la Imagen (desde GitHub)</label>
                <input type="url" id="productImage" placeholder="https://raw.githubusercontent.com/...">
            </div>
            <div class="form-group">
                <label>
                    <input type="checkbox" id="productFeatured" style="width: auto; margin-right: 10px;">
                    Mostrar en Primicias
                </label>
            </div>
            <div class="modal-buttons">
                <button class="btn btn-secondary" onclick="closeProductModal()">Cancelar</button>
                <button class="btn btn-primary" onclick="saveProduct()">Guardar</button>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        // IMPORTANTE: Importar Firebase
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, collection, getDocs, addDoc, updateDoc, deleteDoc, doc } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        // ====================================================================
        // CONFIGURACI√ìN DE FIREBASE
        // ====================================================================
        // Reemplaza esto con tus credenciales de Firebase
        // Para obtenerlas: https://console.firebase.google.com
        const firebaseConfig = {
   apiKey: "AIzaSyBxnLcnw9PYt5WFFyhitaKABZLas7vqyyI",
  authDomain: "jemas-90f83.firebaseapp.com",
  projectId: "jemas-90f83",
  storageBucket: "jemas-90f83.firebasestorage.app",
  messagingSenderId: "564567215682",
  appId: "1:564567215682:web:eda0a516a22d81f685e7db",
  measurementId: "G-7CJ8RN6B2W"
        };

        // Variables globales
        let db = null;
        let products = [];
        let isLoggedIn = false;
        let currentCarouselIndex = 0;
        let editingProductId = null;
        let useFirebase = false;

        // Datos de ejemplo (fallback si Firebase no est√° configurado)
        const sampleProducts = [
            {
                id: "1",
                name: "pulsera-blanca",
                category: "accesorios",
                price: 9.00,
                description: "pulsera blanca con detalles pineaple",
                image: "https://raw.githubusercontent.com/yalucepadi/imagenes-tienda/master/accesorios/accesorio-1.jpeg",
                featured: true
            },
            {
                id: "2",
                name: "Camiseta Vintage",
                category: "ropa",
                price: 24.99,
                description: "Estilo retro, 100% algod√≥n",
                image: "https://images.unsplash.com/photo-1521572163474-6864f9cf17ab?w=500",
                featured: true
            },
            {
                id: "3",
                name: "Mochila Escolar",
                category: "accesorios",
                price: 35.50,
                description: "Resistente y espaciosa",
                image: "https://images.unsplash.com/photo-1553062407-98eeb64c6a62?w=500",
                featured: true
            },
            {
                id: "4",
                name: "Set de Construcci√≥n",
                category: "juguetes",
                price: 29.99,
                description: "200 piezas de diversi√≥n",
                image: "https://images.unsplash.com/photo-1587654780291-39c9404d746b?w=500",
                featured: false
            }
        ];

        // Inicializar Firebase
        function initFirebase() {
            try {
                // Verificar si las credenciales est√°n configuradas
                if (firebaseConfig.apiKey === "TU-API-KEY-AQUI") {
                    console.warn("Firebase no configurado. Usando datos de ejemplo.");
                    document.getElementById('setupNotice').style.display = 'block';
                    useFirebase = false;
                    products = [...sampleProducts];
                    renderProducts();
                    renderCarousel();
                    return;
                }

                // Inicializar Firebase
                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                useFirebase = true;
                console.log("‚úÖ Firebase conectado correctamente");
                
                // Cargar productos desde Firestore
                loadProductsFromFirebase();
            } catch (error) {
                console.error("Error al inicializar Firebase:", error);
                document.getElementById('setupNotice').style.display = 'block';
                useFirebase = false;
                products = [...sampleProducts];
                renderProducts();
                renderCarousel();
            }
        }

        // Cargar productos desde Firebase
        async function loadProductsFromFirebase() {
            try {
                const querySnapshot = await getDocs(collection(db, "productos"));
                products = [];
                querySnapshot.forEach((doc) => {
                    products.push({ id: doc.id, ...doc.data() });
                });

                // Si no hay productos, crear algunos de ejemplo
                if (products.length === 0) {
                    console.log("No hay productos. Creando productos de ejemplo...");
                    for (const product of sampleProducts) {
                        await addDoc(collection(db, "productos"), {
                            name: product.name,
                            category: product.category,
                            price: product.price,
                            description: product.description,
                            image: product.image,
                            featured: product.featured
                        });
                    }
                    await loadProductsFromFirebase();
                    return;
                }

                renderProducts();
                renderCarousel();
                console.log(`‚úÖ ${products.length} productos cargados desde Firebase`);
            } catch (error) {
                console.error("Error al cargar productos:", error);
                alert("Error al cargar productos de Firebase");
            }
        }

        // Guardar producto en Firebase
        async function saveProductToFirebase(productData) {
            try {
                if (editingProductId) {
                    // Actualizar producto existente
                    const productRef = doc(db, "productos", editingProductId);
                    await updateDoc(productRef, productData);
                    alert("‚úÖ Producto actualizado correctamente");
                } else {
                    // Agregar nuevo producto
                    await addDoc(collection(db, "productos"), productData);
                    alert("‚úÖ Producto agregado correctamente");
                }
                
                await loadProductsFromFirebase();
                if (isLoggedIn) {
                    window.renderAdminPanel();
                }
            } catch (error) {
                console.error("Error al guardar producto:", error);
                alert("‚ùå Error al guardar producto: " + error.message);
            }
        }

        // Eliminar producto de Firebase
        async function deleteProductFromFirebase(id) {
            try {
                await deleteDoc(doc(db, "productos", id));
                alert("üóëÔ∏è Producto eliminado");
                await loadProductsFromFirebase();
                if (isLoggedIn) {
                    window.renderAdminPanel();
                }
            } catch (error) {
                console.error("Error al eliminar producto:", error);
                alert("‚ùå Error al eliminar producto: " + error.message);
            }
        }

        // Funciones auxiliares (sin Firebase)
        function saveProductLocal(productData) {
            if (editingProductId) {
                const index = products.findIndex(p => p.id === editingProductId);
                products[index] = { ...products[index], ...productData };
                alert("‚úÖ Producto actualizado (solo en esta sesi√≥n)");
            } else {
                const newId = Date.now().toString();
                products.push({ id: newId, ...productData });
                alert("‚úÖ Producto agregado (solo en esta sesi√≥n)");
            }
            renderProducts();
            renderCarousel();
            window.renderAdminPanel();
        }

        function deleteProductLocal(id) {
            products = products.filter(p => p.id !== id);
            alert("üóëÔ∏è Producto eliminado (solo en esta sesi√≥n)");
            renderProducts();
            renderCarousel();
            window.renderAdminPanel();
        }

        // Exponer funciones globalmente
        window.saveProduct = async function() {
            const productData = {
                name: document.getElementById('productName').value,
                category: document.getElementById('productCategory').value,
                price: parseFloat(document.getElementById('productPrice').value),
                description: document.getElementById('productDescription').value,
                image: document.getElementById('productImage').value,
                featured: document.getElementById('productFeatured').checked
            };

            if (!productData.name || !productData.price || !productData.image) {
                alert('Por favor completa todos los campos obligatorios');
                return;
            }

            window.closeProductModal();

            if (useFirebase) {
                await saveProductToFirebase(productData);
            } else {
                saveProductLocal(productData);
            }
        };

        window.deleteProduct = async function(id) {
            if (!confirm('¬øEst√°s seguro de eliminar este producto?')) return;

            if (useFirebase) {
                await deleteProductFromFirebase(id);
            } else {
                deleteProductLocal(id);
            }
        };

        window.editProduct = function(id) {
            const product = products.find(p => p.id === id);
            if (!product) return;

            editingProductId = id;
            document.getElementById('productModalTitle').textContent = 'Editar Producto';
            document.getElementById('productName').value = product.name;
            document.getElementById('productCategory').value = product.category;
            document.getElementById('productPrice').value = product.price;
            document.getElementById('productDescription').value = product.description;
            document.getElementById('productImage').value = product.image;
            document.getElementById('productFeatured').checked = product.featured;
            document.getElementById('productModal').classList.add('active');
        };

        window.openAddProductModal = function() {
            editingProductId = null;
            document.getElementById('productModalTitle').textContent = 'Agregar Producto';
            document.getElementById('productName').value = '';
            document.getElementById('productCategory').value = 'peluches';
            document.getElementById('productPrice').value = '';
            document.getElementById('productDescription').value = '';
            document.getElementById('productImage').value = '';
            document.getElementById('productFeatured').checked = false;
            document.getElementById('productModal').classList.add('active');
        };

        window.closeProductModal = function() {
            document.getElementById('productModal').classList.remove('active');
        };

        // Renderizar productos
        function renderProducts(filter = 'todos') {
            const grid = document.getElementById('productsGrid');
            let filteredProducts = filter === 'todos' 
                ? products 
                : products.filter(p => p.category === filter);

            if (filteredProducts.length === 0) {
                grid.innerHTML = '<p class="loading">No hay productos en esta categor√≠a</p>';
                return;
            }

            grid.innerHTML = filteredProducts.map(product => `
                <div class="product-card">
                    <img src="${product.image}" alt="${product.name}">
                    <div class="product-info">
                        <h4>${product.name}</h4>
                        <p>${product.description}</p>
                        <div class="product-price">S/. ${product.price.toFixed(2)}</div>
                    </div>
                </div>
            `).join('');
        }

        // Renderizar carrusel
        function renderCarousel() {
            const track = document.getElementById('carouselTrack');
            const dots = document.getElementById('carouselDots');
            const featured = products.filter(p => p.featured);

            if (featured.length === 0) {
                track.innerHTML = '<div class="loading">No hay primicias disponibles</div>';
                dots.innerHTML = '';
                return;
            }

            track.innerHTML = featured.map(product => `
                <div class="carousel-item">
                    <img src="${product.image}" alt="${product.name}">
                    <div class="carousel-caption">
                        <h3>${product.name}</h3>
                        <p>${product.description} - S/. ${product.price.toFixed(2)}</p>
                    </div>
                </div>
            `).join('');

            dots.innerHTML = featured.map((_, i) => 
                `<div class="dot ${i === 0 ? 'active' : ''}" onclick="goToSlide(${i})"></div>`
            ).join('');
        }

        // Renderizar panel admin
        window.renderAdminPanel = function() {
            const grid = document.getElementById('adminGrid');
            grid.innerHTML = products.map(product => `
                <div class="admin-item">
                    <img src="${product.image}" alt="${product.name}">
                    <h4>${product.name}</h4>
                    <p>Categor√≠a: ${product.category}</p>
                    <p>Precio: $${product.price.toFixed(2)}</p>
                    <p>${product.featured ? '‚≠ê En Primicias' : ''}</p>
                    <div class="admin-actions">
                        <button class="btn-edit" onclick="editProduct('${product.id}')">Editar</button>
                        <button class="btn-delete" onclick="deleteProduct('${product.id}')">Eliminar</button>
                    </div>
                </div>
            `).join('');
        };

        // Filtrar categor√≠as
        window.filterCategory = function(category) {
            document.querySelectorAll('.category-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            renderProducts(category);
        };

        // Carrusel
        window.moveCarousel = function(direction) {
            const featured = products.filter(p => p.featured);
            if (featured.length === 0) return;
            currentCarouselIndex = (currentCarouselIndex + direction + featured.length) % featured.length;
            updateCarousel();
        };

        window.goToSlide = function(index) {
            currentCarouselIndex = index;
            updateCarousel();
        };

        function updateCarousel() {
            const track = document.getElementById('carouselTrack');
            track.style.transform = `translateX(-${currentCarouselIndex * 100}%)`;

            document.querySelectorAll('.dot').forEach((dot, i) => {
                dot.classList.toggle('active', i === currentCarouselIndex);
            });
        }

        function startAutoCarousel() {
            setInterval(() => {
                const featured = products.filter(p => p.featured);
                if (featured.length > 0) {
                    window.moveCarousel(1);
                }
            }, 5000);
        }

        // Login
        window.openLoginModal = function() {
            document.getElementById('loginModal').classList.add('active');
        };

        window.closeLoginModal = function() {
            document.getElementById('loginModal').classList.remove('active');
        };

        window.login = function() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;

            if (username === "admin" && password === "admin123") {
                isLoggedIn = true;
                window.closeLoginModal();
                document.getElementById('adminPanel').classList.add('active');
                window.renderAdminPanel();
                alert('¬°Bienvenido, Admin! üëã');
            } else {
                alert('‚ùå Credenciales incorrectas');
            }
        };

        window.logout = function() {
            isLoggedIn = false;
            document.getElementById('adminPanel').classList.remove('active');
            alert('Sesi√≥n cerrada correctamente');
        };

        // Iniciar aplicaci√≥n
        window.onload = function() {
            initFirebase();
            startAutoCarousel();
        };
    </script>
</body>
</html>